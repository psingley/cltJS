define(["jquery","underscore","backbone","marionette","event.aggregator","moment","app","renderedLayouts/booking/paymentSummary/PaymentFormLayout","views/validation/InfoView"],function($,e,t,a,n,i,s,o,r){var d=o.extend({regions:{messagesRegion:"#agentPaymentMessagesRegion"},events:function(){var t={"click #OptOutOfPayment":"togglePaymentSection"};return e.extend(t,o.prototype.events)},initialize:function(){var e=this;n.on("flightIsChosen",function(e){var t=$("#OptOutOfPayment");t.length>0&&(e?t.closest(".pad").show():t.closest(".pad").hide())}),n.on("updateBookingInfoComplete",function(t){var a=$("#OptOutOfPayment");if(a.length>0){var n=new i(t.startDate),o=(new i).startOf("day"),d=n.diff(o,"days",!0);if(60>d){a.attr("disabled",!0),a.parent().addClass("muted");var l=s.dictionary.get("tourRelated.Booking.SummaryPayment.Validations.CannotOptOutPayment");e.messagesRegion.show(new r([l]))}else a.attr("disabled",!1),a.parent().removeClass("muted"),e.messagesRegion.close()}}),n.on("submitTourDateComplete",function(){var t=e.$el.find("#hCartId"),a=e.$el.find("#hPackageDateId");t.val(s.Booking.cartId),a.val(s.Booking.packageDateId)})},togglePaymentSection:function(){var e=this.$el.find(".passenger_payment_header"),t=this.$el.find(".passenger_payment_address"),a=this.$el.find(".passenger_payment_choice"),n=this.$el.find("#paymentForm"),i=this.$el.find("#OptOutOfPayment");i.is(":checked")?(e.slideUp(),a.slideUp(),t.slideUp(),n.slideUp()):(e.slideDown(),a.slideDown(),t.slideDown(),n.slideDown())},validateAddressForm:function(){var t=[],a=this.$el.find("#OptOutOfPayment");if(e.isEmpty(a))return d.__super__.validateAddressForm.apply(this);var n=a.is(":checked");return n?t:d.__super__.validateAddressForm.apply(this)},validateBillingForm:function(){var t=[],a=this.$el.find("#OptOutOfPayment"),n=this.$el.find("#Accept").not(":checked").length>0,i=this.$el.find("#AcceptHazardousMaterials").not(":checked").length>0,o=s.dictionary.get("tourRelated.Booking.SummaryPayment.Validations.AcceptTerms"),r=s.dictionary.get("tourRelated.Booking.SummaryPayment.Validations.AcceptHazardousMaterialsTerms");return e.isEmpty(a)||!a.is(":checked")?d.__super__.validateBillingForm.apply(this):(n&&t.push(o),i&&t.push(r),t)}});return d});